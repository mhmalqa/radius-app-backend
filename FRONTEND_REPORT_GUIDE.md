# دليل ربط ميزة "التقرير المالي الشامل" (Financial Report)

مرحباً، هذا المستند يحتوي على كافة التفاصيل التقنية لربط صفحة التقارير المالية الجديدة في لوحة التحكم (Dashboard).

## 1. رابط الـ API (Endpoint)

**GET** `/api/admin/revenues/financial-report`

### المعاملات (Query Parameters):
| الاسم | النوع | إلزامي | الوصف | مثال |
| :--- | :--- | :--- | :--- | :--- |
| `start_date` | `Date (Y-m-d)` | نعم | تاريخ بداية التقرير | `2024-01-01` |
| `end_date` | `Date (Y-m-d)` | نعم | تاريخ نهاية التقرير | `2024-01-31` |

---

## 2. هيكلية البيانات (Response Structure)

الرد يحتوي على قسمين رئيسيين:
1.  **`report`**: مصفوفة تحتوي على الملخص المالي لكل عملة (USD, SYP, TRY).
2.  **`expired_users`**: قائمة بالمستخدمين الذين انتهت اشتراكاتهم في هذه الفترة ولم يجددوا.

### مثال كامل للرد (JSON Response):

```json
{
    "success": true,
    "data": {
        "period": {
            "start_date": "2024-01-01",
            "end_date": "2024-01-31"
        },
        "generated_at": "2024-02-01T12:00:00+00:00",
        
        // القسم الأول: التقرير المالي (مقسم حسب العملة)
        "report": [
            {
                "currency": "USD",
                "summary": {
                    "income": 5000.00,       // إجمالي الدخل
                    "expenses": 1200.00,     // إجمالي المصاريف
                    "net_profit": 3800.00    // صافي الربح
                },
                "activity": {
                    "renewals_count": 150,       // عدد الاشتراكات المجددة
                    "transactions_count": 160,   // عدد حركات الدفع
                    "withdrawals_count": 5       // عدد حركات السحب
                }
            },
            {
                "currency": "SYP",
                "summary": {
                    "income": 15000000.00,
                    "expenses": 5000000.00,
                    "net_profit": 10000000.00
                },
                "activity": {
                    "renewals_count": 300,
                    "transactions_count": 310,
                    "withdrawals_count": 10
                }
            }
        ],

        // القسم الثاني: قائمة المشتركين المنتهية صلاحيتهم (للمتابعة والتسويق)
        "expired_users": [
            {
                "user_id": 101,
                "username": "ahmed_client",
                "firstname": "أحمد",
                "phone": "0912345678",
                "plan_name": "Gold 4Mbps",
                "expiration_date": "2024-01-15",
                "days_since_expiry": 16
            },
            {
                "user_id": 205,
                "username": "sara_net",
                "firstname": "سارة",
                "phone": "0987654321",
                "plan_name": "Silver 2Mbps",
                "expiration_date": "2024-01-20",
                "days_since_expiry": 11
            }
        ],
        "note": "التقرير المالي الشامل (فاتورة)"
    }
}
```

---

## 3. مقترحات للتصميم (UI/UX)

### أ. الفلاتر (Filters Section):
*   حقلين لاختيار التاريخ: **من تاريخ** (Start Date) و **إلى تاريخ** (End Date).
*   زر **"استخراج التقرير"** (Generate Report).
*   أزرار سريعة للفترات: (اليوم، هذا الأسبوع، هذا الشهر).

### ب. عرض البيانات (Data Display):
1.  **بطاقات الملخص (Summary Cards):**
    *   عرض بطاقة منفصلة لكل عملة (Tab أو Cards بجانب بعضها).
    *   داخل كل بطاقة، اعرض بوضوح: **الدخل** (بالأخضر)، **المصاريف** (بالأحمر)، **صافي الربح** (بالأزرق/الأسود).
    *   عرض عداد الاشتراكات المجددة.

2.  **جدول المنقطعين (Expired Users Table):**
    *   عنوان: "مشتركين انتهت باقاتهم ولم يجددوا".
    *   الأعمدة: الاسم، رقم الهاتف (زر اتصال/واتساب)، الباقة، تاريخ الانتهاء، أيام الانقطاع.
    *   زر "تصدير" خاص بهذا الجدول.

### ج. التصدير (Export Options):
لتحقيق ميزة "تصدير كملف Excel أو PDF احترافي"، يمكنك استخدام مكتبات في الفرونت إند مثل:
*   **للـ PDF:** مكتبة `jspdf` و `jspdf-autotable`. قم بتصميم الفاتورة بشعار الشبكة وجدول منسق يحتوي على بيانات الـ `report`.
*   **للـ Excel:** مكتبة `xlsx` (SheetJS). قم بتصدير صفحة للملخص المالي وصفحة أخرى لقائمة المنقطعين.

---

**ملاحظة:** البيانات جاهزة ومحسوبة بالكامل من الباك إند، دور الفرونت إند هو العرض والتنسيق فقط.
