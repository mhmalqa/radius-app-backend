# ๐ ุฏููู ุนูููุฉ ุงูุชุณุฌูู ูุน ุงูุชุญูู ูู Radius

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุญุฏูุซ ุนูููุฉ ุงูุชุณุฌูู ููุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู ูู ูุธุงู Radius ูุจู ุงูุณูุงุญ ุจุฅูุดุงุก ุงูุญุณุงุจ.

## ๐ ุชุฏูู ุงูุชุณุฌูู

### ุงูุฎุทูุงุช:

1. **ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช** (Validation)
   - ุงูุชุญูู ูู ุฃู ุฌููุน ุงูุญููู ูุทููุจุฉ ูุตุญูุญุฉ
   - ุงูุชุญูู ูู ุฃู ุงุณู ุงููุณุชุฎุฏู ุบูุฑ ูุณุชุฎุฏู ูู ุงูุชุทุจูู (ูู `RegisterRequest`)

2. **ุงูุชุญูู ูู ุงูุชุทุจูู** โญ (ุฌุฏูุฏ)
   - ุงูุชุญูู ูุฑุฉ ุฃุฎุฑู ูู ุฃู ุงููุณุชุฎุฏู ุบูุฑ ูุณุฌู ูู ุงูุชุทุจูู (`app_users`)
   - ุฅุฐุง ูุงู ูุณุฌูุ ุฅุฑุฌุงุน: "ุงููุณุชุฎุฏู ูุณุฌู ุจุงููุนู ูู ุงูุชุทุจูู"

3. **ุงูุชุญูู ูู Radius** โญ
   - ุงูุชุญูู ูู ุฃู ุงุณู ุงููุณุชุฎุฏู ููุฌูุฏ ูู ูุธุงู Radius
   - ุงูุชุญูู ูู ุฃู ุงูุงุณุชุฌุงุจุฉ ูู Radius ุชุญุชูู ุนูู `status: "success"`
   - ุฅุฐุง ูู ููู ููุฌูุฏุ ุฅุฑุฌุงุน: "ุงุณู ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ ูู ูุธุงู Radius"

4. **ุฅูุดุงุก ุงูุญุณุงุจ**
   - ุฅุฐุง ูุฌุญุช ุฌููุน ุงูุชุญููุงุชุ ูุชู ุฅูุดุงุก ุงูุญุณุงุจ

## ๐ ูุซุงู ุนูู ุงูุงุณุชุฎุฏุงู

### โ ุชุณุฌูู ูุงุฌุญ (ุงููุณุชุฎุฏู ููุฌูุฏ ูู Radius)

```http
POST /api/auth/register
Content-Type: application/json

{
    "username": "001",
    "password": "password123",
    "password_confirmation": "password123",
    "phone": "07501234567",
    "email": "user@example.com",
    "language": "ar"
}
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
    "success": true,
    "message": "ุชู ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ",
    "data": {
        "user": {
            "id": 1,
            "username": "001",
            ...
        },
        "token": "1|xxxxxxxxxxxxx"
    }
}
```

### โ ุชุณุฌูู ูุงุดู (ุงููุณุชุฎุฏู ูุณุฌู ุจุงููุนู)

```http
POST /api/auth/register
Content-Type: application/json

{
    "username": "existing_user",
    "password": "password123",
    "password_confirmation": "password123"
}
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
    "success": false,
    "message": "ุงููุณุชุฎุฏู ูุณุฌู ุจุงููุนู ูู ุงูุชุทุจูู."
}
```

### โ ุชุณุฌูู ูุงุดู (ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ ูู Radius)

```http
POST /api/auth/register
Content-Type: application/json

{
    "username": "non_existent_user",
    "password": "password123",
    "password_confirmation": "password123"
}
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
    "success": false,
    "message": "ุงุณู ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ ูู ูุธุงู Radius. ูุฑุฌู ุงูุชุญูู ูู ุงุณู ุงููุณุชุฎุฏู."
}
```

## ๐ง ุงูุชุบููุฑุงุช ุงูุชูููุฉ

### 1. `RadiusSyncService::userExistsInRadius()`

Method ุฌุฏูุฏ ููุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู ูู Radius:

```php
public function userExistsInRadius(string $username): bool
{
    // ูุชุญูู ูู Radius API
    // ูุฑุฌุน true ุฅุฐุง ูุงู status === "success"
    // ูุฑุฌุน false ูู ุฃู ุญุงูุฉ ุฃุฎุฑู
}
```

### 2. `AuthService::register()`

ุชู ุชุญุฏูุซ method ุงูุชุณุฌูู:

```php
public function register(array $data): AppUser
{
    // ุงูุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ุบูุฑ ูุณุฌู ูู ุงูุชุทุจูู
    $existingUser = AppUser::where('username', $data['username'])->first();
    if ($existingUser) {
        throw new \Exception('ุงููุณุชุฎุฏู ูุณุฌู ุจุงููุนู ูู ุงูุชุทุจูู.');
    }
    
    // ุงูุชุญูู ูู Radius
    if (!$this->radiusSyncService->userExistsInRadius($data['username'])) {
        throw new \Exception('ุงุณู ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ ูู ูุธุงู Radius...');
    }
    
    // ุฅูุดุงุก ุงูุญุณุงุจ
    return AppUser::create([...]);
}
```

### 3. `AuthController::register()`

ุชูุช ุฅุถุงูุฉ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:

```php
try {
    $user = $this->authService->register($request->validated());
    // ...
} catch (\Exception $e) {
    return response()->json([
        'success' => false,
        'message' => $e->getMessage(),
    ], 422);
}
```

## โ๏ธ ุญุงูุงุช ุงูุฎุทุฃ

### 1. ุงููุณุชุฎุฏู ูุณุฌู ุจุงููุนู ูู ุงูุชุทุจูู

**ุงูุฑุณุงูุฉ**: "ุงููุณุชุฎุฏู ูุณุฌู ุจุงููุนู ูู ุงูุชุทุจูู."

**ุงูุญุงูุฉ**: 422 (Unprocessable Entity)

**ูุชู ูุญุฏุซ**: ุนูุฏูุง ูููู username ููุฌูุฏ ูู ุฌุฏูู `app_users`

### 2. ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ ูู Radius

**ุงูุฑุณุงูุฉ**: "ุงุณู ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ ูู ูุธุงู Radius. ูุฑุฌู ุงูุชุญูู ูู ุงุณู ุงููุณุชุฎุฏู."

**ุงูุญุงูุฉ**: 422 (Unprocessable Entity)

**ูุชู ูุญุฏุซ**: ุนูุฏูุง ูุง ูููู username ููุฌูุฏ ูู Radius ุฃู ูุดู ุงูุงุชุตุงู

### 3. ูุดู ุงูุงุชุตุงู ุจู Radius API

**ุงูุณููู**: ูุชู ุงุนุชุจุงุฑ ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ (ูุฑุฌุน false)

**ุงูุชุณุฌูู**: ูุชู ุชุณุฌูู ุงูุฎุทุฃ ูู `storage/logs/laravel.log`

### 4. ุงุณู ุงููุณุชุฎุฏู ูุณุชุฎุฏู ุจุงููุนู (ูู Validation)

**ุงูุฑุณุงูุฉ**: "ุงุณู ุงููุณุชุฎุฏู ูุณุชุฎุฏู ุจุงููุนู"

**ุงูุญุงูุฉ**: 422 (Validation Error)

**ูุชู ูุญุฏุซ**: ูู `RegisterRequest` ูุจู ุงููุตูู ุฅูู `AuthService`

## ๐ ุงูุชุญูู ูู ุงูู Logs

ุนูุฏ ูุดู ุงูุชุญูู ูู Radiusุ ูุชู ุชุณุฌูู ุงูุฎุทุฃ:

```php
Log::error('Failed to check user existence in Radius', [
    'username' => $username,
    'error' => $e->getMessage(),
]);
```

ููููู ูุญุต ุงูู logs ูู:
- `storage/logs/laravel.log`

## ๐ ุชุฏูู ุงูุจูุงูุงุช

```
User Request
    โ
RegisterRequest (Validation)
    โ (ุฅุฐุง ูุดู: "ุงุณู ุงููุณุชุฎุฏู ูุณุชุฎุฏู ุจุงููุนู")
    โ
AuthController::register()
    โ
AuthService::register()
    โ
Check: User exists in app_users?
    โ (ุฅุฐุง ููุฌูุฏ: "ุงููุณุชุฎุฏู ูุณุฌู ุจุงููุนู ูู ุงูุชุทุจูู")
    โ
RadiusSyncService::userExistsInRadius()
    โ
Radius API Check
    โ (ุฅุฐุง ุบูุฑ ููุฌูุฏ: "ุงุณู ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ ูู ูุธุงู Radius")
    โ
[All Checks Pass?] โ Yes โ Create Account โ Success
    โ
    No โ Throw Exception โ Error Response
```

## ๐ฏ ุงูููุงุฆุฏ

1. **ุงูุฃูุงู**: ุงูุชุฃูุฏ ูู ุฃู ุงููุณุชุฎุฏููู ุงููุณุฌููู ููุฌูุฏูู ูุนููุงู ูู ูุธุงู Radius
2. **ุงูุชูุงูู**: ุฑุจุท ุงูุชุทุจูู ูุจุงุดุฑุฉ ูุน ูุธุงู Radius
3. **ุงูููุซูููุฉ**: ููุน ุฅูุดุงุก ุญุณุงุจุงุช ููุณุชุฎุฏููู ุบูุฑ ููุฌูุฏูู

## ๐ง ุงูุชุฎุตูุต

ุฅุฐุง ููุช ุชุฑูุฏ ุชุบููุฑ ุฑุณุงูุฉ ุงูุฎุทุฃุ ููููู ุชุนุฏูููุง ูู:

`app/Services/AuthService.php` - method `register()`

```php
throw new \Exception('ุฑุณุงูุชู ุงููุฎุตุตุฉ ููุง');
```

