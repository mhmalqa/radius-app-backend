# ๐ ุฏููู ุงุณุชุฎุฏุงู ุจูุงูุงุช ุงูุงุดุชุฑุงู

## ๐ ุงููุฒุงููุฉ vs ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ

### ูุง ูู ุงููุฒุงููุฉุ

**ุงููุฒุงููุฉ** = ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู ูู Radius ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ

**ูุชู ุชุญุฏุซ**:

-   ุนูุฏ ุงูุทูุจ: ุงููุณุชุฎุฏู ูุถุบุท "ุชุญุฏูุซ"
-   ุชููุงุฆูุงู: ูู ุณุงุนุฉ/ููู (Cron Job)
-   ุจุนุฏ ุงูุฃุญุฏุงุซ: ุจุนุฏ ูุจูู ุทูุจ ุฏูุน

**ุงููุงุฆุฏุฉ**:

-   โก ุณุฑูุน ุฌุฏุงู (ุงูุจูุงูุงุช ูุญููุธุฉ ูุญููุงู)
-   โ ูุนูู ุญุชู ูู ูุงู Radius ุบูุฑ ูุชุงุญ
-   ๐ ูููู ุชุชุจุน ุงูุชุบููุฑุงุช ุนุจุฑ ุงูุฒูู

---

### ูุง ูู ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉุ

**ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ** = ุฌูุจ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ ูู Radius API ุจุฏูู ุญูุธ

**ูุชู ุชุณุชุฎุฏู**:

-   ุนูุฏ ุงูุญุงุฌุฉ ูุจูุงูุงุช ูุญุธูุฉ
-   ุนูุฏ ุนุฑุถ ุญุงูุฉ ุงูุงุชุตุงู (`is_online`)
-   ุนูุฏ ุงูุชุญูู ูู ุฑุตูุฏ ูุญุฏุซ

**ุงููุงุฆุฏุฉ**:

-   โ ุจูุงูุงุช ูุญุธูุฉ ููุจุงุดุฑุฉ
-   โ ุฏุงุฆูุงู ุฃุญุฏุซ ุงูุจูุงูุงุช
-   โ ุฃุจุทุฃ (ูุญุชุงุฌ ุงุชุตุงู ุจู API)

---

## ๐ก API Endpoints

### 1. ุงููุฒุงููุฉ (ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช)

```http
POST /api/user/sync-subscription
Authorization: Bearer {token}
```

**ูุง ูุญุฏุซ**:

1. ูุฌูุจ ุงูุจูุงูุงุช ูู Radius API
2. ูุญูุธูุง ูู `user_subscriptions` table
3. ูุฑุฌุน ุงูุจูุงูุงุช ุงููุญููุธุฉ

**ุงูุงุณุชุฌุงุจุฉ:**

```json
{
    "success": true,
    "message": "ุชู ูุฒุงููุฉ ุจูุงูุงุช ุงูุงุดุชุฑุงู ุจูุฌุงุญ",
    "data": {
        "subscription": {
            "id": 1,
            "expiration_at": "2026-01-02 10:00:00",
            "balance": 8.0,
            "plan_name": "2M-PPP",
            "data_used": 79352827904,
            "is_online": false,
            "download_kbps": 2097152,
            "total_MB": 75688.39,
            "last_synced_at": "2025-12-10 09:00:00"
        }
    }
}
```

---

### 2. ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ (ูู API ูุจุงุดุฑุฉ)

```http
GET /api/user/subscription-from-radius
Authorization: Bearer {token}
```

**ูุง ูุญุฏุซ**:

1. ูุฌูุจ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ ูู Radius API
2. **ูุง ูุญูุธ** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ูุฑุฌุน ุงูุจูุงูุงุช ูุจุงุดุฑุฉ

**ุงูุงุณุชุฌุงุจุฉ:**

```json
{
    "success": true,
    "message": "ุชู ุฌูุจ ุจูุงูุงุช ุงูุงุดุชุฑุงู ุจูุฌุงุญ",
    "data": {
        "subscription": {
            "expiration_at": "2026-01-02 10:00:00",
            "balance": 8.0,
            "plan_name": "2M-PPP",
            "data_used": 79352827904,
            "is_online": false,
            "download_kbps": 2097152,
            "upload_kbps": 20971520,
            "download_mbps": 2097.2,
            "upload_mbps": 20971.5,
            "download_MB": 8371.59,
            "upload_MB": 67316.8,
            "total_MB": 75688.39,
            "firstname": "ุงูุดูุฎ ุงุญูุฏ ุงูุทุญุจุด",
            "mobile": "",
            "is_active_radius": true
        },
        "fetched_at": "2025-12-10 09:15:30",
        "source": "radius_api_direct"
    }
}
```

---

### 3. ุนุฑุถ ุงูููู ุงูุดุฎุตู (ุงูุจูุงูุงุช ุงููุญููุธุฉ)

```http
GET /api/user/profile
Authorization: Bearer {token}
```

**ุงูุงุณุชุฌุงุจุฉ:**

```json
{
    "success": true,
    "data": {
        "user": {...},
        "subscription": {
            // ุงูุจูุงูุงุช ุงููุญููุธุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
            "last_synced_at": "2025-12-10 09:00:00"
        }
    }
}
```

---

## ๐ ุฌููุน ุงูุญููู ุงููุญููุธุฉ

### ุงูุญููู ุงูุฃุณุงุณูุฉ:

-   โ `expiration_at` - ุชุงุฑูุฎ ุงูุงูุชูุงุก
-   โ `balance` - ุงูุฑุตูุฏ
-   โ `plan_name` - ุงุณู ุงูุฎุทุฉ
-   โ `data_used` - ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ (bytes)
-   โ `data_limit` - ุญุฏ ุงูุจูุงูุงุช (bytes)

### ุงูุญููู ุงูุฅุถุงููุฉ (ุฌุฏูุฏุฉ):

-   โ `firstname` - ุงูุงุณู ุงููุงูู ูู Radius
-   โ `mobile` - ุฑูู ุงููุงุชู
-   โ `is_active_radius` - ุญุงูุฉ ุงููุดุงุท ูู Radius
-   โ `is_online` - ุญุงูุฉ ุงูุงุชุตุงู (ูุชุตู/ุบูุฑ ูุชุตู)
-   โ `download_kbps` - ุณุฑุนุฉ ุงูุชุญููู (kbps)
-   โ `upload_kbps` - ุณุฑุนุฉ ุงูุฑูุน (kbps)
-   โ `download_mbps` - ุณุฑุนุฉ ุงูุชุญููู (mbps)
-   โ `upload_mbps` - ุณุฑุนุฉ ุงูุฑูุน (mbps)
-   โ `download_MB` - ุจูุงูุงุช ุงูุชุญููู (MB)
-   โ `upload_MB` - ุจูุงูุงุช ุงูุฑูุน (MB)
-   โ `total_MB` - ุฅุฌูุงูู ุงูุจูุงูุงุช (MB)
-   โ `raw_data` - ุงูุจูุงูุงุช ุงููุงููุฉ ูู Radius (JSON)

---

## ๐ฏ ูุชู ุชุณุชุฎุฏู ูู ุทุฑููุฉุ

### ุงุณุชุฎุฏู ุงููุฒุงููุฉ (`/sync-subscription`) ุนูุฏูุง:

1. โ ุนุฑุถ ุจูุงูุงุช ุงูุงุดุชุฑุงู ูู ุงูุชุทุจูู (ุณุฑูุน)
2. โ ุนูุฏ ูุชุญ ุงูุชุทุจูู (ุชุญุฏูุซ ุงูุจูุงูุงุช)
3. โ ุจุนุฏ ูุจูู ุทูุจ ุฏูุน
4. โ ูุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุงูุชูุงุก ุงูุงุดุชุฑุงู

### ุงุณุชุฎุฏู ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ (`/subscription-from-radius`) ุนูุฏูุง:

1. โ ุนุฑุถ ุดุงุดุฉ ุงูุงุดุชุฑุงู (ุจูุงูุงุช ูุญุธูุฉ)
2. โ ุงูุชุญูู ูู ุญุงูุฉ ุงูุงุชุตุงู (`is_online`)
3. โ ุนุฑุถ ุงูุฑุตูุฏ ุงููุญุฏุซ
4. โ ุนูุฏ ุงูุญุงุฌุฉ ูุฏูุฉ ุนุงููุฉ

---

## โฐ ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ (Cron Job)

ูุฅุนุฏุงุฏ ูุฒุงููุฉ ุชููุงุฆูุฉ ูู ุณุงุนุฉ:

```php
// app/Console/Kernel.php
protected function schedule(Schedule $schedule)
{
    // ูุฒุงููุฉ ุฌููุน ุงููุณุชุฎุฏููู ูู ุณุงุนุฉ
    $schedule->call(function () {
        app(\App\Services\RadiusSyncService::class)->syncAllUsers();
    })->hourly();
}
```

ุซู ูู ุจุชุดุบูู:

```bash
php artisan schedule:work
```

---

## ๐ ูุซุงู ุนูู ุงูุงุณุชุฎุฏุงู ูู ุงูุชุทุจูู

```javascript
// 1. ุนูุฏ ูุชุญ ุงูุชุทุจูู - ูุฒุงููุฉ ุงูุจูุงูุงุช
await api.post("/api/user/sync-subscription");

// 2. ุนุฑุถ ุงูุจูุงูุงุช ุงููุญููุธุฉ (ุณุฑูุน)
const profile = await api.get("/api/user/profile");
console.log(profile.data.subscription);

// 3. ุนูุฏ ุงูุญุงุฌุฉ ูุจูุงูุงุช ูุญุธูุฉ - ูุฑุงุกุฉ ูุจุงุดุฑุฉ
const fresh = await api.get("/api/user/subscription-from-radius");
console.log(fresh.data.subscription.is_online); // ุญุงูุฉ ุงูุงุชุตุงู ูุญุธูุฉ
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงููุฒุงููุฉ ุชุญูุธ** ูู `user_subscriptions` table
2. **ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ ูุง ุชุญูุธ**ุ ููุท ุชุนุฑุถ
3. ูููู ุงุณุชุฎุฏุงู **ููุง ุงูุทุฑููุชูู** ูุนุงู
4. ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ ุชุญุชุงุฌ ุฅุนุฏุงุฏ Cron Job
5. ุฌููุน ุงูุญููู ูู Radius ูุชู ุญูุธูุง ุงูุขู

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุชุดุบูู Migration**:

```bash
php artisan migrate
```

2. **ุงุฎุชุจุงุฑ ุงููุฒุงููุฉ**:

```bash
# ูู Postman ุฃู ุงูุชุทุจูู
POST /api/user/sync-subscription
```

3. **ุงุฎุชุจุงุฑ ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ**:

```bash
GET /api/user/subscription-from-radius
```
