# ๐ ุงููุฒุงููุฉ vs ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ ูู Radius

## ๐ ุงููุฑู ุจูู ุงููุฒุงููุฉ ูุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ

### ๐ ุงููุฒุงููุฉ (Sync)

**ุงููุนูู**: ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู ูู Radius ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ (`user_subscriptions`)

**ุงููููุฒุงุช**:
- โ **ุณุฑุนุฉ**: ุงูุจูุงูุงุช ูุญููุธุฉ ูุญููุงูุ ูุง ุญุงุฌุฉ ูุงูุชุธุงุฑ API
- โ **ููุซูููุฉ**: ุชุนูู ุญุชู ูู ูุงู Radius API ุบูุฑ ูุชุงุญ
- โ **ุฃุฏุงุก**: ุงุณุชุนูุงูุงุช ุณุฑูุนุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ **ุชุงุฑูุฎ**: ูููู ุชุชุจุน ุงูุชุบููุฑุงุช ุนุจุฑ ุงูุฒูู
- โ **ุชูููู ุงูุญูู**: ูุง ูุญุชุงุฌ ูุงุณุชุฏุนุงุก API ูู ูู ูุฑุฉ

**ุงูุนููุจ**:
- โ **ูุฏ ุชููู ูุฏููุฉ**: ุงูุจูุงูุงุช ูุฏ ูุง ุชููู ูุญุฏุซุฉ
- โ **ูุญุชุงุฌ ุชุญุฏูุซ**: ูุฌุจ ุงููุฒุงููุฉ ุฏูุฑูุงู

**ูุชู ุชุณุชุฎุฏู**:
- ุนูุฏ ุนุฑุถ ุจูุงูุงุช ุงูุงุดุชุฑุงู ูู ุงูุชุทุจูู
- ุนูุฏ ุงูุญุงุฌุฉ ูุณุฑุนุฉ ูู ุงูุงุณุชุฌุงุจุฉ
- ุนูุฏ ุนุฏู ุงูุญุงุฌุฉ ูุจูุงูุงุช ูุญุธูุฉ

---

### ๐ก ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ (Direct Read)

**ุงููุนูู**: ุฌูุจ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ ูู Radius API ุนูุฏ ูู ุทูุจ ุจุฏูู ุญูุธ

**ุงููููุฒุงุช**:
- โ **ุฏูุฉ**: ุจูุงูุงุช ูุญุธูุฉ ููุจุงุดุฑุฉ ูู ุงููุตุฏุฑ
- โ **ุชุญุฏูุซ ููุฑู**: ุฏุงุฆูุงู ุฃุญุฏุซ ุงูุจูุงูุงุช
- โ **ูุง ูุญุชุงุฌ ูุณุงุญุฉ**: ูุง ูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุนููุจ**:
- โ **ุจุทุก**: ูุญุชุงุฌ ููุช ููุงุชุตุงู ุจู API
- โ **ุงุนุชูุงุฏ ุนูู API**: ุฅุฐุง ูุงู Radius ุบูุฑ ูุชุงุญุ ูุง ุชุนูู
- โ **ุญูู ุนูู ุงูุฎุงุฏู**: ุงุณุชุฏุนุงุก API ูู ูู ูุฑุฉ

**ูุชู ุชุณุชุฎุฏู**:
- ุนูุฏ ุงูุญุงุฌุฉ ูุจูุงูุงุช ูุญุธูุฉ (ูุซู ุญุงูุฉ ุงูุงุชุตุงู `online`)
- ุนูุฏ ุงูุชุญูู ูู ุฑุตูุฏ ูุญุฏุซ
- ุนูุฏ ุนุฑุถ ุจูุงูุงุช ุฏูููุฉ ุฌุฏุงู

---

## ๐ฏ ุงูุญู ุงูููุตู ุจู: ูุธุงู ูุฌูู

ุงุณุชุฎุฏู **ููุง ุงูุทุฑููุชูู** ุญุณุจ ุงูุญุงุฌุฉ:

### 1. ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ (Automated Sync)

```php
// ูุฒุงููุฉ ุฏูุฑูุฉ ูู ุณุงุนุฉ ุฃู ููููุงู
// ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
POST /api/user/sync-subscription
```

**ูุชู**: 
- ุนูุฏ ูุชุญ ุงูุชุทุจูู
- ูู ุณุงุนุฉ (Cron Job)
- ุจุนุฏ ูุจูู ุทูุจ ุฏูุน

### 2. ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ (On-Demand)

```php
// ูุฑุงุกุฉ ูุจุงุดุฑุฉ ุนูุฏ ุงูุญุงุฌุฉ ูุจูุงูุงุช ูุญุธูุฉ
GET /api/user/subscription-from-radius
```

**ูุชู**:
- ุนูุฏ ุนุฑุถ ุดุงุดุฉ ุงูุงุดุชุฑุงู
- ุนูุฏ ุงูุญุงุฌุฉ ูุจูุงูุงุช ุฏูููุฉ
- ุนูุฏ ุงูุชุญูู ูู ุญุงูุฉ ุงูุงุชุตุงู

---

## ๐ ููุงุฑูุฉ ุณุฑูุนุฉ

| ุงูููุฒุฉ | ุงููุฒุงููุฉ | ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ |
|--------|----------|------------------|
| **ุงูุณุฑุนุฉ** | โก ุณุฑูุน ุฌุฏุงู | ๐ ุฃุจุทุฃ |
| **ุงูุฏูุฉ** | โฐ ูุฏ ุชููู ูุฏููุฉ | โ ูุญุธูุฉ |
| **ุงูููุซูููุฉ** | โ ุชุนูู ุฏุงุฆูุงู | โ ุชุนุชูุฏ ุนูู API |
| **ุงูุญูู** | โ ููุฎูุถ | โ ุนุงูู |
| **ุงูุชุฎุฒูู** | โ ูุญูุธ | โ ูุง ูุญูุธ |

---

## ๐ง ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุงููุฒุงููุฉ (ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช)

```http
POST /api/user/sync-subscription
Authorization: Bearer {token}
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
    "success": true,
    "message": "ุชู ูุฒุงููุฉ ุจูุงูุงุช ุงูุงุดุชุฑุงู ุจูุฌุงุญ",
    "data": {
        "subscription": {
            "id": 1,
            "expiration_at": "2026-01-02 10:00:00",
            "balance": 8.00,
            "plan_name": "2M-PPP",
            "data_used": 79352827904,
            "last_synced_at": "2025-12-10 09:00:00",
            ...
        }
    }
}
```

### ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ (ูู API ูุจุงุดุฑุฉ)

```http
GET /api/user/subscription-from-radius
Authorization: Bearer {token}
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
    "success": true,
    "message": "ุชู ุฌูุจ ุจูุงูุงุช ุงูุงุดุชุฑุงู ุจูุฌุงุญ",
    "data": {
        "subscription": {
            "expiration_at": "2026-01-02 10:00:00",
            "balance": 8.00,
            "plan_name": "2M-PPP",
            "data_used": 79352827904,
            "is_online": false,
            "download_kbps": 2097152,
            "upload_kbps": 20971520,
            "total_MB": 75688.39,
            ...
        },
        "fetched_at": "2025-12-10 09:15:30",
        "source": "radius_api_direct"
    }
}
```

---

## โฐ ูุชู ูุชู ุงููุฒุงููุฉุ

### 1. ูุฒุงููุฉ ูุฏููุฉ
- ุงููุณุชุฎุฏู ูุถุบุท ุฒุฑ "ุชุญุฏูุซ" ูู ุงูุชุทุจูู
- Endpoint: `POST /api/user/sync-subscription`

### 2. ูุฒุงููุฉ ุชููุงุฆูุฉ (Cron Job)

ูููู ุฅุนุฏุงุฏ Cron Job ูููุฒุงููุฉ ุงูุชููุงุฆูุฉ:

```php
// app/Console/Kernel.php
protected function schedule(Schedule $schedule)
{
    // ูุฒุงููุฉ ูู ุณุงุนุฉ
    $schedule->call(function () {
        app(RadiusSyncService::class)->syncAllUsers();
    })->hourly();
    
    // ุฃู ูุฒุงููุฉ ููููุงู ูู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู
    $schedule->call(function () {
        app(RadiusSyncService::class)->syncAllUsers();
    })->dailyAt('02:00');
}
```

### 3. ูุฒุงููุฉ ุนูุฏ ุงูุฃุญุฏุงุซ
- ุจุนุฏ ูุจูู ุทูุจ ุฏูุน
- ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู (ุงุฎุชูุงุฑู)
- ุนูุฏ ูุชุญ ุตูุญุฉ ุงูุงุดุชุฑุงู (ุงุฎุชูุงุฑู)

---

## ๐ ุงูุญููู ุงููุญููุธุฉ ุงูุขู

### ุงูุญููู ุงูุฃุณุงุณูุฉ:
- `expiration_at` - ุชุงุฑูุฎ ุงูุงูุชูุงุก
- `balance` - ุงูุฑุตูุฏ
- `plan_name` - ุงุณู ุงูุฎุทุฉ
- `data_used` - ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ (bytes)
- `data_limit` - ุญุฏ ุงูุจูุงูุงุช (bytes)

### ุงูุญููู ุงูุฅุถุงููุฉ (ุฌุฏูุฏุฉ):
- `firstname` - ุงูุงุณู ุงููุงูู
- `mobile` - ุฑูู ุงููุงุชู
- `is_active_radius` - ุญุงูุฉ ุงููุดุงุท ูู Radius
- `is_online` - ุญุงูุฉ ุงูุงุชุตุงู
- `download_kbps` - ุณุฑุนุฉ ุงูุชุญููู (kbps)
- `upload_kbps` - ุณุฑุนุฉ ุงูุฑูุน (kbps)
- `download_mbps` - ุณุฑุนุฉ ุงูุชุญููู (mbps)
- `upload_mbps` - ุณุฑุนุฉ ุงูุฑูุน (mbps)
- `download_MB` - ุจูุงูุงุช ุงูุชุญููู (MB)
- `upload_MB` - ุจูุงูุงุช ุงูุฑูุน (MB)
- `total_MB` - ุฅุฌูุงูู ุงูุจูุงูุงุช (MB)
- `raw_data` - ุงูุจูุงูุงุช ุงููุงููุฉ ูู Radius (JSON)

---

## ๐ฏ ุงูุชูุตูุฉ ุงูููุงุฆูุฉ

### ุงุณุชุฎุฏู ุงููุฒุงููุฉ ุนูุฏูุง:
1. โ ุนุฑุถ ุจูุงูุงุช ุงูุงุดุชุฑุงู ูู ุงูุชุทุจูู
2. โ ุนุฑุถ ูุงุฆูุฉ ุงููุณุชุฎุฏููู
3. โ ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุงูุชูุงุก ุงูุงุดุชุฑุงู
4. โ ุชูุงุฑูุฑ ูุฅุญุตุงุฆูุงุช

### ุงุณุชุฎุฏู ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ ุนูุฏูุง:
1. โ ุนุฑุถ ุดุงุดุฉ ุงูุงุดุชุฑุงู (ูุจูุงูุงุช ูุญุธูุฉ)
2. โ ุงูุชุญูู ูู ุญุงูุฉ ุงูุงุชุตุงู (`is_online`)
3. โ ุนุฑุถ ุงูุฑุตูุฏ ุงููุญุฏุซ
4. โ ุนูุฏ ุงูุญุงุฌุฉ ูุฏูุฉ ุนุงููุฉ

### ุฃูุถู ููุงุฑุณุฉ:
**ูุฒุงููุฉ ุฏูุฑูุฉ + ูุฑุงุกุฉ ูุจุงุดุฑุฉ ุนูุฏ ุงูุญุงุฌุฉ**

```php
// ูู ุงูุชุทุจูู
// 1. ุงุนุฑุถ ุงูุจูุงูุงุช ุงููุญููุธุฉ (ุณุฑูุน)
$subscription = $user->subscription;

// 2. ุฅุฐุง ุงุญุชุฌุช ุจูุงูุงุช ูุญุฏุซุฉุ ุงูุฑุฃ ูุจุงุดุฑุฉ
$freshData = $radiusSyncService->getUserDataFromRadius($username);
```

---

## ๐ ูุซุงู ุนูู ุงูุงุณุชุฎุฏุงู ูู ุงูุชุทุจูู

```javascript
// 1. ุนุฑุถ ุงูุจูุงูุงุช ุงููุญููุธุฉ (ุณุฑูุน)
const subscription = await api.get('/api/user/profile');
// ูุนุฑุถ ุงูุจูุงูุงุช ุงููุญููุธุฉ

// 2. ุชุญุฏูุซ ุงูุจูุงูุงุช (ูุฒุงููุฉ)
await api.post('/api/user/sync-subscription');
// ูุญูุธ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

// 3. ูุฑุงุกุฉ ูุจุงุดุฑุฉ (ูุญุธูุฉ)
const freshData = await api.get('/api/user/subscription-from-radius');
// ูุนุฑุถ ุฃุญุฏุซ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ ูู Radius
```

---

## ๐ ููุงุญุธุงุช

- ุงููุฒุงููุฉ ุชุญูุธ ูู `user_subscriptions` table
- ุงููุฑุงุกุฉ ุงููุจุงุดุฑุฉ ูุง ุชุญูุธุ ููุท ุชุนุฑุถ
- ูููู ุงุณุชุฎุฏุงู ููุง ุงูุทุฑููุชูู ูุนุงู
- ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ ุชุญุชุงุฌ ุฅุนุฏุงุฏ Cron Job

