# ๐ข ุญุงูุฉ ุงูุฅุดุนุงุฑุงุช ุงูุชููุงุฆูุฉ

## โ ุงูุญุงูุฉ ุงูุญุงููุฉ

ุงูุฅุดุนุงุฑุงุช ุงูุชููุงุฆูุฉ **ููุนูุฉ ููุฌุฏููุฉ** ุจุดูู ุตุญูุญ!

## ๐ ุงูุฅุดุนุงุฑุงุช ุงููุฌุฏููุฉ

### ุฅุดุนุงุฑุงุช ุงูุชูุงุก ุงูุงุดุชุฑุงู:

1. **ูุจู ููููู (48 ุณุงุนุฉ)**

    - ุงูุฌุฏููุฉ: ููููุงู ูู ุงูุณุงุนุฉ 9:00 ุตุจุงุญุงู
    - ุงูุฃูุฑ: `php artisan notifications:subscription-expiry --hours=48`

2. **ูุจู ููู (24 ุณุงุนุฉ)**

    - ุงูุฌุฏููุฉ: ููููุงู ูู ุงูุณุงุนุฉ 9:00 ุตุจุงุญุงู
    - ุงูุฃูุฑ: `php artisan notifications:subscription-expiry --hours=24`

3. **ูุจู ุณุงุนุชูู (2 ุณุงุนุงุช)**

    - ุงูุฌุฏููุฉ: ูู ุณุงุนุฉ
    - ุงูุฃูุฑ: `php artisan notifications:subscription-expiry --hours=2`

4. **ูุจู ุณุงุนุฉ (1 ุณุงุนุฉ)**

    - ุงูุฌุฏููุฉ: ูู ุณุงุนุฉ
    - ุงูุฃูุฑ: `php artisan notifications:subscription-expiry --hours=1`

5. **ุฃุซูุงุก ูุตู ุงูุฎุฏูุฉ (ุนูุฏ ุงูุชูุงุก ุงูุงุดุชุฑุงู)**

    - ุงูุฌุฏููุฉ: ูู 5 ุฏูุงุฆู
    - ุงูุฃูุฑ: `php artisan notifications:subscription-expired`
    - ูุจุญุซ ุนู ุงูุงุดุชุฑุงูุงุช ุงูุชู ุงูุชูุช ูู ุขุฎุฑ 5 ุฏูุงุฆู

6. **ุจุนุฏ ุฑุจุน ุณุงุนุฉ ูู ุงูุชูุงุก ุงูุงุดุชุฑุงู**
    - ุงูุฌุฏููุฉ: ูู 5 ุฏูุงุฆู
    - ุงูุฃูุฑ: `php artisan notifications:subscription-expired`
    - ูุจุญุซ ุนู ุงูุงุดุชุฑุงูุงุช ุงูุชู ุงูุชูุช ููุฐ 15 ุฏูููุฉ ุจุงูุถุจุท

### ุฅุดุนุงุฑุงุช ุงูุจุซ ุงููุจุงุดุฑ:

-   **ููู ุงูุจุซ ุงููุจุงุดุฑ**
    -   ุงูุฌุฏููุฉ: ููููุงู ูู ุงูุณุงุนุฉ 8:00 ุตุจุงุญุงู
    -   ุงูุฃูุฑ: `php artisan notifications:live-stream-day`

---

## ๐ ููููุฉ ุงูุชุญูู ูู ุฃู ุงูุฅุดุนุงุฑุงุช ุชุนูู

### 1. ุนุฑุถ ุงูุฌุฏููุฉ

```bash
php artisan schedule:list
```

ูุฌุจ ุฃู ุชุฑู ุฌููุน ุงูููุงู ุงููุฌุฏููุฉ ูุน ููุนุฏ ุงูุชูููุฐ ุงูุชุงูู.

### 2. ุงุฎุชุจุงุฑ ุงูุฃูุงูุฑ ูุฏููุงู

#### ุงุฎุชุจุงุฑ ุฅุดุนุงุฑ ูุจู ุณุงุนุชูู:

```bash
php artisan notifications:subscription-expiry --hours=2
```

#### ุงุฎุชุจุงุฑ ุฅุดุนุงุฑ ูุจู ุณุงุนุฉ:

```bash
php artisan notifications:subscription-expiry --hours=1
```

#### ุงุฎุชุจุงุฑ ุฅุดุนุงุฑ ุงูุชูุงุก ุงูุงุดุชุฑุงู:

```bash
php artisan notifications:subscription-expired
```

### 3. ุชุดุบูู ุงูุฌุฏููุฉ ูุฏููุงู (ููุชุทููุฑ)

```bash
php artisan schedule:work
```

ูุฐุง ุงูุฃูุฑ ุณูุนูู ูู ุงูุฎูููุฉ ููุดุบู ุงูููุงู ุงููุฌุฏููุฉ ุชููุงุฆูุงู.

### 4. ุงูุชุญูู ูู ุงูุณุฌูุงุช

```bash
# ุนุฑุถ ุขุฎุฑ ุงูุณุฌูุงุช
tail -f storage/logs/laravel.log
```

ุงุจุญุซ ุนู:

-   `Subscription expiry notifications sent`
-   `Subscription expired notifications sent`

---

## โ๏ธ ุฅุนุฏุงุฏ Cron Job (ููุฅูุชุงุฌ)

### ุนูู Linux/Unix:

ุฃุถู ูุฐุง ุงูุณุทุฑ ูู crontab:

```bash
* * * * * cd /path-to-your-project && php artisan schedule:run >> /dev/null 2>&1
```

ูุชุญุฑูุฑ crontab:

```bash
crontab -e
```

### ุนูู Windows:

ุงุณุชุฎุฏู **Task Scheduler**:

1. ุงูุชุญ Task Scheduler
2. ุฃูุดุฆ ูููุฉ ุฌุฏูุฏุฉ
3. ุนููู ุงููุดุบู: `php artisan schedule:run`
4. ุนููู ุงูุชูุฑุงุฑ: ูู ุฏูููุฉ

ุฃู ุงุณุชุฎุฏู ุงูุฃูุฑ ูู PowerShell:

```powershell
# ุชุดุบูู ูู ุฏูููุฉ
while ($true) {
    php artisan schedule:run
    Start-Sleep -Seconds 60
}
```

---

## ๐งช ุงุฎุชุจุงุฑ ุณุฑูุน

### ุงุฎุชุจุงุฑ ุฅุดุนุงุฑ ูุจู ุณุงุนุชูู:

1. ุฃูุดุฆ ุงุดุชุฑุงู ููุชูู ุจุนุฏ ุณุงุนุชูู ุจุงูุถุจุท
2. ุดุบูู ุงูุฃูุฑ:
    ```bash
    php artisan notifications:subscription-expiry --hours=2
    ```
3. ุชุญูู ูู ุฃู ุงูุฅุดุนุงุฑ ุชู ุฅุฑุณุงูู

### ุงุฎุชุจุงุฑ ุฅุดุนุงุฑ ุฃุซูุงุก ูุตู ุงูุฎุฏูุฉ:

1. ุฃูุดุฆ ุงุดุชุฑุงู ููุชูู ุงูุขู
2. ุดุบูู ุงูุฃูุฑ:
    ```bash
    php artisan notifications:subscription-expired
    ```
3. ุชุญูู ูู ุฃู ุงูุฅุดุนุงุฑ ุชู ุฅุฑุณุงูู

---

## ๐ ูุฑุงูุจุฉ ุงูุฅุดุนุงุฑุงุช

### ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```sql
-- ุนุฑุถ ุขุฎุฑ ุงูุฅุดุนุงุฑุงุช ุงููุฑุณูุฉ
SELECT * FROM notifications
ORDER BY created_at DESC
LIMIT 10;

-- ุนุฑุถ ุงูุฅุดุนุงุฑุงุช ุงููุฑุณูุฉ ูููุณุชุฎุฏููู
SELECT n.*, nu.user_id, nu.is_sent, nu.sent_at
FROM notifications n
JOIN notification_user nu ON n.id = nu.notification_id
ORDER BY n.created_at DESC
LIMIT 20;
```

### ูู ุงูุณุฌูุงุช:

ุงุจุญุซ ูู `storage/logs/laravel.log` ุนู:

-   `Creating notification`
-   `FCM send completed`
-   `Subscription expiry notifications sent`

---

## โ๏ธ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุฅุดุนุงุฑุงุช ูุง ุชุฑุณู ุชููุงุฆูุงู

**ุงูุญููู:**

1. **ุชุฃูุฏ ูู ุฃู Cron Job ูุนูู:**

    ```bash
    # ุชุญูู ูู crontab
    crontab -l
    ```

2. **ุงุฎุชุจุฑ ุงูุฌุฏููุฉ ูุฏููุงู:**

    ```bash
    php artisan schedule:run
    ```

3. **ุชุญูู ูู ุงูุณุฌูุงุช:**

    ```bash
    tail -f storage/logs/laravel.log
    ```

4. **ุชุฃูุฏ ูู ุฃู Firebase ููุนูู:**
    - ุชุญูู ูู `config/services.php`
    - ุชุญูู ูู ูุฌูุฏ `storage/app/firebase/service-account-key.json`

### ุงููุดููุฉ: ุงูุฅุดุนุงุฑุงุช ุชุฑุณู ููู ูุง ุชุตู ููููุงุชู

**ุงูุญููู:**

1. **ุชุญูู ูู Firebase Token:**

    - ุชุฃูุฏ ูู ุฃู ุงููุณุชุฎุฏููู ูุฏููู `device_tokens` ุตุญูุญุฉ

2. **ุชุญูู ูู ุฅุนุฏุงุฏุงุช Firebase:**

    - ุชุญูู ูู `FIREBASE_PROJECT_ID` ูู `.env`
    - ุชุญูู ูู `FIREBASE_CREDENTIALS_PATH` ูู `.env`

3. **ุชุญูู ูู ุงูุณุฌูุงุช:**
    ```bash
    grep "FCM" storage/logs/laravel.log
    ```

---

## โ ูุงุฆูุฉ ุงูุชุญูู

-   [x] ุงูุฃูุงูุฑ ููุฌูุฏุฉ ูุชุนูู
-   [x] ุงูุฌุฏููุฉ ููุนูุฉ ูู `routes/console.php`
-   [x] ุฌููุน ุงูุฅุดุนุงุฑุงุช ุงูุณุชุฉ ูุฌุฏููุฉ
-   [ ] Cron Job ููุนูู ุนูู ุงูุฎุงุฏู (ููุฅูุชุงุฌ)
-   [ ] Firebase ููุนูู ููุนุฏ ุจุดูู ุตุญูุญ
-   [ ] ุชู ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช ูุฏููุงู

---

## ๐ ููุงุญุธุงุช

-   ุงูุฅุดุนุงุฑุงุช ุงูุชููุงุฆูุฉ ุชุนูู ููุท ุฅุฐุง ูุงู **Cron Job** ุฃู **schedule:work** ูุนูู
-   ูู ุจูุฆุฉ ุงูุชุทููุฑุ ุงุณุชุฎุฏู `php artisan schedule:work`
-   ูู ุจูุฆุฉ ุงูุฅูุชุงุฌุ ุงุณุชุฎุฏู Cron Job
-   ุฌููุน ุงูุฅุดุนุงุฑุงุช ุชูุณุฌู ูู `storage/logs/laravel.log`

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2024-12-20  
**ุงูุญุงูุฉ**: โ ููุนูู ูุฌุงูุฒ ููุนูู



